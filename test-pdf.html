<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Generation Test</title>
    <!-- Include the same libraries as in the main application -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <h1>PDF Generation Test</h1>
    
    <div id="report-content" style="border: 1px solid #ccc; padding: 20px; margin: 20px;">
        <h2>Sample Report Content</h2>
        <p>This is a test report to verify PDF generation functionality.</p>
        <div class="report-section">
            <h3>Patient Information</h3>
            <p><strong>Name:</strong> Test User</p>
            <p><strong>Date:</strong> 2023-06-15</p>
            <p><strong>Time:</strong> 10:30:00</p>
            <p><strong>Report ID:</strong> AR-TEST123</p>
            <p><strong>Age:</strong> 30</p>
            <p><strong>Gender:</strong> Male</p>
        </div>
        <div class="report-section">
            <h3>Symptom Summary</h3>
            <p>Test symptoms for PDF generation verification.</p>
        </div>
    </div>
    
    <button id="test-pdf-btn">Test PDF Generation</button>
    
    <div id="console-output" style="margin-top: 20px; padding: 10px; background-color: #f0f0f0; font-family: monospace;">
        <h3>Console Output:</h3>
        <div id="log-output"></div>
    </div>

    <script>
        // Override console.log to display in the page
        const logOutput = document.getElementById('log-output');
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        
        console.log = function() {
            const args = Array.from(arguments);
            originalConsoleLog.apply(console, args);
            logOutput.innerHTML += `<div style="color: black;">${args.join(' ')}</div>`;
        };
        
        console.error = function() {
            const args = Array.from(arguments);
            originalConsoleError.apply(console, args);
            logOutput.innerHTML += `<div style="color: red;">${args.join(' ')}</div>`;
        };
        
        // Test PDF generation
        document.getElementById('test-pdf-btn').addEventListener('click', function() {
            try {
                console.log('Starting PDF generation test...');
                
                // Check if libraries are loaded
                if (!window.jspdf || !window.jspdf.jsPDF) {
                    console.error('jsPDF library not properly loaded');
                    return;
                }
                console.log('jsPDF library is properly loaded');
                
                if (!window.html2canvas) {
                    console.error('html2canvas library not properly loaded');
                    return;
                }
                console.log('html2canvas library is properly loaded');
                
                const reportContent = document.getElementById('report-content');
                if (!reportContent) {
                    console.error('Report content element not found');
                    return;
                }
                console.log('Report content element found');
                
                // Show loading message
                console.log('Generating PDF...');
                
                // Use html2canvas to capture the report content
                window.html2canvas(reportContent, {
                    scale: 2, // Higher quality
                    useCORS: true, // Allow cross-origin images
                    logging: true, // Enable logging for debugging
                }).then(canvas => {
                    console.log('Canvas generated successfully');
                    
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    
                    const imgData = canvas.toDataURL('image/png');
                    const imgWidth = 190;
                    const pageHeight = 290;
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    
                    // Add title to the PDF
                    doc.setFontSize(16);
                    doc.setFont('helvetica', 'bold');
                    doc.text('Test PDF Report', 105, 15, { align: 'center' });
                    
                    // Add the report image
                    doc.addImage(imgData, 'PNG', 10, 25, imgWidth, imgHeight);
                    
                    // Save the PDF
                    doc.save('test-report.pdf');
                    console.log('PDF generated and saved successfully');
                }).catch(error => {
                    console.error('Error generating PDF with html2canvas:', error);
                });
            } catch (error) {
                console.error('Error in PDF generation process:', error);
            }
        });
        
        // Run initial tests
        console.log('Testing PDF generation functionality...');
        
        // Check if required libraries are available
        if (typeof window === 'undefined') {
            console.log('This script needs to be run in a browser environment');
        } else {
            // Check if jsPDF is loaded
            if (!window.jspdf || !window.jspdf.jsPDF) {
                console.error('jsPDF library not properly loaded');
            } else {
                console.log('jsPDF library is properly loaded');
            }
            
            // Check if html2canvas is loaded
            if (!window.html2canvas) {
                console.error('html2canvas library not properly loaded');
            } else {
                console.log('html2canvas library is properly loaded');
            }
            
            // Check if report container exists
            const reportContent = document.getElementById('report-content');
            if (!reportContent) {
                console.error('Report content element not found');
            } else {
                console.log('Report content element found');
                console.log('Display style:', window.getComputedStyle(reportContent).display);
            }
        }
        
        console.log('PDF generation test initialization complete');
    </script>
</body>
</html>